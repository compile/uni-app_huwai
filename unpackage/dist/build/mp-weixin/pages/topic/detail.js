(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/topic/detail"],{3194:function(t,n,o){},"3d07":function(t,n,o){"use strict";(function(t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=i(o("a34a"));function i(t){return t&&t.__esModule?t:{default:t}}function s(t,n,o,e,i,s,u){try{var c=t[s](u),a=c.value}catch(r){return void o(r)}c.done?n(a):Promise.resolve(a).then(e,i)}function u(t){return function(){var n=this,o=arguments;return new Promise((function(e,i){var u=t.apply(n,o);function c(t){s(u,e,i,c,a,"next",t)}function a(t){s(u,e,i,c,a,"throw",t)}c(void 0)}))}}var c=function(){o.e("components/post-list/post-list").then(function(){return resolve(o("3cb0"))}.bind(null,o)).catch(o.oe)},a=function(){o.e("components/discuss-list/discuss-list").then(function(){return resolve(o("405f"))}.bind(null,o)).catch(o.oe)},r=function(){o.e("components/user-list/user-list").then(function(){return resolve(o("f81b"))}.bind(null,o)).catch(o.oe)},l={components:{postList:c,disList:a,userList:r},data:function(){return{showPlusPost:!1,showCanvas:!1,showShare:!1,joinTopicModel:!1,delTopicModel:!1,showMenu:!1,current:0,tabList:[{name:"最新"},{name:"最热"}],btnStyle:{marginRight:0,width:"150rpx",fontSize:"12px",height:"60rpx",lineHeight:"60rpx",backgroundColor:"#333",color:"#fff"},shareBtnStyle:{backgroundColor:"#333"},topicId:0,topicInfo:{member_list:[],discuss_list:[],description:"",userInfo:{username:""}},postHot:[],postNews:[],loadStatus:"loading",page1:1,page2:1,background:{backgroundColor:"unset"},sessionUser:t.getStorageSync("userInfo")}},onLoad:function(t){this.topicId=t.id,this.getTopicInfo(),this.getPostList()},onReachBottom:function(){0==this.current&&this.page1++,1==this.current&&this.page2++,this.getPostList()},onPullDownRefresh:function(){0==this.current&&(this.page1=1,this.postNews=[]),1==this.current&&(this.page2=1,this.postHot=[]),this.getPostList(),this.getTopicInfo(),t.stopPullDownRefresh()},onShareAppMessage:function(t){return"button"===t.from&&console.log(t.target),{title:this.topicInfo.topic_name+"-"+this.topicInfo.description,path:"/pages/topic/detail?id="+this.topicId,imageUrl:this.topicInfo.bg_image}},onShareTimeline:function(){return{title:this.topicInfo.topic_name+"-"+this.topicInfo.description,imageUrl:this.topicInfo.bg_image,query:"id="+this.topicId}},filters:{substr:function(t){return t.substr(0,5)},replace:function(t){return t}},methods:{onTopDel:function(n,o){var e=this;t.showModal({title:"提示",content:"是否解除置顶?",success:function(t){t.confirm?e.$H.post("post/topPostDel",{post_id:n.id,topic_id:n.topic_id}).then((function(t){200==t.code&&e.topicInfo.top_post.splice(o,1)})):t.cancel}})},copyPageUrl:function(){var n=this;t.setClipboardData({data:"pages/topic/detail?id="+this.topicId,success:function(){t.hideToast(),n.$q.toast("复制成功","success"),n.showShare=!1}})},onMenu:function(){this.topicInfo.is_join?this.showMenu=!0:this.joinTopicModel=!0},onPlus:function(){this.showPlusPost=!0},saveImgToAlbum:function(){t.canvasToTempFilePath({x:0,y:0,width:300,height:400,canvasId:"shareCanvas",success:function(n){t.saveImageToPhotosAlbum({filePath:n.tempFilePath,success:function(){console.log("save success")}})}})},shareCanvas:function(){var n=this;return u(e.default.mark((function o(){var i,s,u,c;return e.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return t.showLoading({mask:!0,title:"正在生成海报"}),n.showCanvas=!0,n.showShare=!1,i=t.createCanvasContext("shareCanvas"),i.setFillStyle("#FFFFFF"),i.fillRect(0,0,300,400),i.setFillStyle("#000000"),s=i.measureText(n.topicInfo["topic_name"]).width,i.setFontSize(20),i.fillText(n.topicInfo["topic_name"],s/2,40,280),i.setFontSize(16),i.setFillStyle("#999"),i.fillText("邀请你一起加入",s/2,80,280),i.setFontSize(14),i.fillText("微信扫一扫",120,365,280),o.next=17,n.getQrCode();case 17:return u=o.sent,o.next=20,n.downloadFile(u);case 20:c=o.sent,i.drawImage(c,30,100,240,240),i.draw(),t.hideLoading();case 24:case"end":return o.stop()}}),o)})))()},downloadFile:function(n){return new Promise((function(o){t.downloadFile({url:n,success:function(t){o(t.tempFilePath)}})}))},getQrCode:function(){var t=this;return new Promise((function(n){t.$H.get("topic/qrCode",{id:t.topicId}).then((function(t){n(t.result)}))}))},topicDel:function(){var n=this;t.showLoading({mask:!0,title:"操作中"}),this.$H.post("topic/topicDel",{id:this.topicId}).then((function(o){200==o.code&&(n.$u.toast("该圈子已成功解散"),setTimeout((function(){t.switchTab({url:"/pages/index/index"})}),1500)),t.hideLoading()}))},jumpUser:function(){t.navigateTo({url:"/pages/topic/topic-user?id="+this.topicId})},onBack:function(){var n=getCurrentPages();n.length>1?t.navigateBack():t.switchTab({url:"/pages/index/index"})},tabsChange:function(t){this.current=t,1==t&&0==this.postHot.length&&this.getPostList()},onTrigger:function(n){3==n?t.navigateTo({url:"/pages/vote/vote?topic_id="+this.topicId}):t.navigateTo({url:"/pages/post/add?topic_id="+this.topicId+"&topic_name="+this.topicInfo.topic_name+"&type="+n})},jump:function(n){t.navigateTo({url:"/pages/user/home?uid="+n})},joinTopic:function(){var t=this;this.$H.post("topic/joinTopic",{id:this.topicId}).then((function(n){200===n.code&&(t.topicInfo.is_join=!0,t.joinTopicModel=!1)}))},selectscenic:function(){console.log("id:"+this.topicId),t.navigateTo({url:"/pages/product/grouplist"})},outTopic:function(){var t=this;this.$H.post("topic/userTopicDel",{id:this.topicId}).then((function(n){200===n.code&&(t.topicInfo.is_join=!1,t.showMenu=!1)}))},getTopicInfo:function(){var t=this;this.$H.get("topic/detail",{id:this.topicId}).then((function(n){t.topicInfo=n.result,console.log("test"),console.log(n.result)}))},jumpMenu:function(n){this.showMenu=!1,t.navigateTo({url:n})},getPostList:function(){var t=this;this.loadStatus="loading";var n=this.page1,o="id desc";1==this.current&&(n=this.page2,o="read_count desc"),console.log("this.topicId:"),console.log(this.topicId),this.$H.get("post/list",{topic_id:this.topicId,page:n,order:o}).then((function(n){0==t.current&&(t.postNews=t.postNews.concat(n.result.data)),1==t.current&&(t.postHot=t.postHot.concat(n.result.data)),n.result.current_page===n.result.last_page||0===n.result.last_page?t.loadStatus="nomore":t.loadStatus="loadmore"}))}}};n.default=l}).call(this,o("543d")["default"])},"43e0":function(t,n,o){"use strict";o.r(n);var e=o("6f9c"),i=o("4a56");for(var s in i)"default"!==s&&function(t){o.d(n,t,(function(){return i[t]}))}(s);o("b1c9"),o("aeaa");var u,c=o("f0c5"),a=Object(c["a"])(i["default"],e["b"],e["c"],!1,null,"a464a45a",null,!1,e["a"],u);n["default"]=a.exports},"4a56":function(t,n,o){"use strict";o.r(n);var e=o("3d07"),i=o.n(e);for(var s in e)"default"!==s&&function(t){o.d(n,t,(function(){return e[t]}))}(s);n["default"]=i.a},"6f9c":function(t,n,o){"use strict";o.d(n,"b",(function(){return i})),o.d(n,"c",(function(){return s})),o.d(n,"a",(function(){return e}));var e={uNavbar:function(){return o.e("uview-ui/components/u-navbar/u-navbar").then(o.bind(null,"be15"))},uButton:function(){return o.e("uview-ui/components/u-button/u-button").then(o.bind(null,"fa8a"))},uIcon:function(){return o.e("uview-ui/components/u-icon/u-icon").then(o.bind(null,"312f"))},uTabs:function(){return Promise.all([o.e("common/vendor"),o.e("uview-ui/components/u-tabs/u-tabs")]).then(o.bind(null,"4784"))},postList:function(){return o.e("components/post-list/post-list").then(o.bind(null,"3cb0"))},qPopup:function(){return o.e("uni_modules/q-view/components/q-popup/q-popup").then(o.bind(null,"b976"))},uGrid:function(){return o.e("uview-ui/components/u-grid/u-grid").then(o.bind(null,"6adb"))},uGridItem:function(){return o.e("uview-ui/components/u-grid-item/u-grid-item").then(o.bind(null,"3438"))},uModal:function(){return o.e("uview-ui/components/u-modal/u-modal").then(o.bind(null,"f188"))},uPopup:function(){return o.e("uview-ui/components/u-popup/u-popup").then(o.bind(null,"a63f"))}},i=function(){var t=this,n=t.$createElement,o=(t._self._c,t.__map(t.topicInfo.top_post,(function(n,o){var e=t.__get_orig(n),i=n.content.substring(0,15);return{$orig:e,g0:i}}))),e=t.topicInfo.discuss_list.length>0?t.__map(t.topicInfo.discuss_list,(function(n,o){var e=t.__get_orig(n),i=n.title.substring(0,10);return{$orig:e,g1:i}})):null;t._isMounted||(t.e0=function(n){t.showShare=!0},t.e1=function(n){t.showMenu=!1},t.e2=function(n){t.delTopicModel=!0}),t.$mp.data=Object.assign({},{$root:{l0:o,l1:e}})},s=[]},a7a9:function(t,n,o){},aeaa:function(t,n,o){"use strict";var e=o("3194"),i=o.n(e);i.a},b1c9:function(t,n,o){"use strict";var e=o("a7a9"),i=o.n(e);i.a},cfc7:function(t,n,o){"use strict";(function(t){o("251e");e(o("66fd"));var n=e(o("43e0"));function e(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=o,t(n.default)}).call(this,o("543d")["createPage"])}},[["cfc7","common/runtime","common/vendor"]]]);