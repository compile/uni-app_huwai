(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/post/add"],{"5b61":function(t,o,e){"use strict";(function(t){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var i=n(e("62e1"));function n(t){return t&&t.__esModule?t:{default:t}}function s(t,o,e){return o in t?Object.defineProperty(t,o,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[o]=e,t}var c=[["camera"],["album"],["camera","album"]],u=[["compressed"],["original"],["compressed","original"]],a={data:function(){return{imageList:[],imagecount:0,uploadImgUrl:this.$c.domain+"common/uploadimg",topicName:"选择圈子",disName:"选择话题",videoInfo:s({thumb:"",width:"",height:"",duration:"",size:""},"width",""),form:{title:"",type:1,topic_id:"",discuss_id:"",content:"",media:[],videoInfo:"",longitude:0,latitude:0,address:""},header:{token:t.getStorageSync("token")},isTopic:!0,sourceTypeIndex:2,sourceType:["拍照","相册","拍照或相册"],sizeTypeIndex:2,sizeType:["压缩","原图","压缩或原图"],countIndex:8,count:[1,2,3,4,5,6,7,8,9],imgAllUrl:[]}},onLoad:function(o){this.form.type=o.type,o.is_topic&&(this.isTopic=o.is_topic),o.topic_id&&(this.form.topic_id=o.topic_id,this.isTopic=!1),o.discuss_id&&(this.form.discuss_id=o.discuss_id);var e=t.getStorageSync("location_info");this.form.longitude=e.longitude,this.form.latitude=e.latitude},methods:{addPic:function(o){var e=this;console.log(this.imgAllUrl);var i=this;console.log(this.imagecount),t.chooseImage({sourceType:c[this.sourceTypeIndex],sizeType:u[this.sizeTypeIndex],count:this.imageList.length+this.count[this.countIndex]>9?9-this.imageList.length:this.count[this.countIndex],success:function(t){e.imageList=e.imageList.concat(t.tempFilePaths);e.imageList;var o=t.tempFilePaths;console.log(o),o.forEach((function(t,o){i.imgAllUrl.push(t)}))}})},previewImage:function(o){var e=o.target.dataset.src;t.previewImage({current:e,urls:this.imageList})},delect:function(o,e){var i=this;t.showModal({title:"提示",content:"是否删除该图片？",success:function(t){if(t.confirm){var e=function(t,o){for(var e=0;e<t.length;e++)if(t[e]==o){t.splice(e,1);break}},n=i.imgAllUrl[o],s=i.imageList.splice(n,1);e(i.imageList,s),i.imgAllUrl=i.imageList}}})},chooseVideo:function(){var o=this;t.chooseVideo({count:1,sourceType:["camera","album"],success:function(e){e.tempFilePath;t.showLoading({mask:!0,title:"上传中"}),console.log(console.log),console.log(e),o.videoInfo.duration=e.duration,o.videoInfo.height=e.height,o.videoInfo.size=e.size,o.videoInfo.width=e.width,i.default.uploadFileToTencentClound("test.jpg",e.thumbTempFilePath).then((function(t){console.log("[修改s视频图片]",t),o.videoInfo.thumb=t})),console.log(o.form),i.default.uploadFileToTencentClound("test.mp4",e.tempFilePath).then((function(e){console.log("[修改头像]",e),o.form.media.push(e),t.hideLoading()}))}})},errorback:function(){console.log("test")},test2:function(){console.log("hehe")},uploadImg:function(){this.form.topic_id?this.form.content?t.showLoading({mask:!0,title:"发布中"}):this.$u.toast("内容不能为空"):this.$u.toast("请选择圈子")},chooseLocation:function(){var o=this;t.chooseLocation({success:function(t){o.form.address=t.name,o.form.latitude=t.latitude,o.form.longitude=t.longitude}})},videoSubmit:function(){0!=this.form.media.length?this.form.topic_id?(t.showLoading({mask:!0,title:"发布中"}),console.log(this.form),console.log("videoInfo"),console.log(this.videoInfo),this.form.videoInfo=this.videoInfo,this.$H.post("post/addPost",this.form).then((function(o){200==o.code&&t.redirectTo({url:"/pages/post/video-detail?id="+o.result.id}),t.hideLoading()}))):this.$u.toast("请选择圈子"):this.$u.toast("请上传视频")},submit:function(o){t.showLoading({mask:!0,title:"发布中"});var e=[];o.forEach((function(t,o){console.log(t),e.push(t.response.url)})),this.form.media=e,this.$H.post("post/addPost",this.form).then((function(o){200==o.code&&t.redirectTo({url:"/pages/post/detail?id="+o.result.id}),t.hideLoading()}))}}};o.default=a}).call(this,e("543d")["default"])},"809f":function(t,o,e){"use strict";e.d(o,"b",(function(){return n})),e.d(o,"c",(function(){return s})),e.d(o,"a",(function(){return i}));var i={uniIcons:function(){return Promise.all([e.e("common/vendor"),e.e("components/uni-icons/uni-icons")]).then(e.bind(null,"8d34"))},uIcon:function(){return e.e("uview-ui/components/u-icon/u-icon").then(e.bind(null,"312f"))},qButton:function(){return e.e("uni_modules/q-view/components/q-button/q-button").then(e.bind(null,"4114"))}},n=function(){var t=this,o=t.$createElement;t._self._c},s=[]},"8d62":function(t,o,e){"use strict";var i=e("db0f"),n=e.n(i);n.a},b3ad:function(t,o,e){"use strict";e.r(o);var i=e("809f"),n=e("dee0");for(var s in n)"default"!==s&&function(t){e.d(o,t,(function(){return n[t]}))}(s);e("8d62");var c,u=e("f0c5"),a=Object(u["a"])(n["default"],i["b"],i["c"],!1,null,"57aff865",null,!1,i["a"],c);o["default"]=a.exports},c5a1:function(t,o,e){"use strict";(function(t){e("251e");i(e("66fd"));var o=i(e("b3ad"));function i(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=e,t(o.default)}).call(this,e("543d")["createPage"])},db0f:function(t,o,e){},dee0:function(t,o,e){"use strict";e.r(o);var i=e("5b61"),n=e.n(i);for(var s in i)"default"!==s&&function(t){e.d(o,t,(function(){return i[t]}))}(s);o["default"]=n.a}},[["c5a1","common/runtime","common/vendor"]]]);