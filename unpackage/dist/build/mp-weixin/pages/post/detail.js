(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/post/detail"],{"05c9":function(t,e,o){"use strict";var i=o("e65d"),n=o.n(i);n.a},"1ae0":function(t,e,o){"use strict";o.r(e);var i=o("48ed"),n=o.n(i);for(var s in i)"default"!==s&&function(t){o.d(e,t,(function(){return i[t]}))}(s);e["default"]=n.a},3890:function(t,e,o){"use strict";o.d(e,"b",(function(){return n})),o.d(e,"c",(function(){return s})),o.d(e,"a",(function(){return i}));var i={uButton:function(){return o.e("uview-ui/components/u-button/u-button").then(o.bind(null,"fa8a"))},qButton:function(){return o.e("uni_modules/q-view/components/q-button/q-button").then(o.bind(null,"4114"))},uIcon:function(){return o.e("uview-ui/components/u-icon/u-icon").then(o.bind(null,"312f"))},uAvatar:function(){return o.e("uview-ui/components/u-avatar/u-avatar").then(o.bind(null,"c135"))},uLoadmore:function(){return o.e("uview-ui/components/u-loadmore/u-loadmore").then(o.bind(null,"99cd"))},uEmpty:function(){return o.e("uview-ui/components/u-empty/u-empty").then(o.bind(null,"3977"))},qPopup:function(){return o.e("uni_modules/q-view/components/q-popup/q-popup").then(o.bind(null,"b976"))},uPopup:function(){return o.e("uview-ui/components/u-popup/u-popup").then(o.bind(null,"a63f"))}},n=function(){var t=this,e=t.$createElement,o=(t._self._c,t._f("timeFrom")(t.postDetail.create_time)),i=4!==t.postDetail.type||t.isVoteExpire?null:t._f("date")(t.postDetail.vote_info.expire_time,"yyyy年mm月dd日hh时MM分"),n=t.postDetail.topicInfo.topic_name.substring(0,15),s=t.__map(t.commentList,(function(e,o){var i=t.__get_orig(e),n=t._f("timeFrom")(e.create_time),s=t.__map(e.children,(function(o,i){var n=t.__get_orig(o),s=e.children.length>0?t._f("timeFrom")(o.createtime):null;return{$orig:n,f3:s}}));return{$orig:i,f2:n,l0:s}}));t._isMounted||(t.e0=function(e){t.focus=!0},t.e1=function(e){t.showShare=!0},t.e2=function(e){t.showShare=!1}),t.$mp.data=Object.assign({},{$root:{f0:o,f1:i,g0:n,l1:s}})},s=[]},"48ed":function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=n(o("a34a"));function n(t){return t&&t.__esModule?t:{default:t}}function s(t,e,o,i,n,s,a){try{var u=t[s](a),c=u.value}catch(r){return void o(r)}u.done?e(c):Promise.resolve(c).then(i,n)}function a(t){return function(){var e=this,o=arguments;return new Promise((function(i,n){var a=t.apply(e,o);function u(t){s(a,i,n,u,c,"next",t)}function c(t){s(a,i,n,u,c,"throw",t)}u(void 0)}))}}var u={data:function(){return{unitId:this.$c.postDetailAd,postId:0,postDetail:{comment:[],media:[],comment_list:{data:[]},topic_info:{topic_name:""}},focus:!1,isSubmitD:!1,commentList:[],placeholder:"说点什么...",form:{pid:0,type:1,to_uid:"",post_id:"",content:""},showShare:!1,showCanvas:!1,shareBtnStyle:{backgroundColor:"#333"},page:1,loadStatus:"loadmore",isVoteExpire:!1}},onLoad:function(t){this.postId=t.id,t.scene&&(this.postId=t.scene),this.form.post_id=this.postId,this.getPostDetail(),this.getCommentList(),wx.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]})},onReachBottom:function(){this.page++,this.getCommentList()},onShareAppMessage:function(t){var e;return"button"===t.from&&console.log(t.target),this.postDetail.media.length>0&&(e=this.postDetail.media[0]),{title:this.postDetail.content,path:"/pages/post/detail?id="+this.postId,imageUrl:e}},onShareTimeline:function(){var t=t=this.postDetail.media[0];return{title:this.postDetail.content,imageUrl:t,query:"id="+this.postId}},methods:{voteSubmit:function(){var t=this,e=[];this.postDetail.vote_info.options.forEach((function(t){t.checked&&e.push(t.id)})),this.$H.post("vote/userVote",{id:this.postDetail.vote_info.id,vote:e}).then((function(e){200==e.code&&t.getPostDetail()}))},castVote:function(t,e){var o=this;if(!this.postDetail.is_vote_result&&!this.isVoteExpire){1===e&&this.postDetail.vote_info.options.forEach((function(t){o.$set(t,"checked",!1)}));var i=this.postDetail.vote_info.options[t].checked;i?this.$set(this.postDetail.vote_info.options[t],"checked",!1):this.$set(this.postDetail.vote_info.options[t],"checked",!0)}},delComment:function(e,o,i){var n=this,s=t.getStorageSync("userInfo");e.uid==s.uid&&t.showModal({title:"提示",content:"确定删除该评论？",success:function(t){t.confirm?n.$H.post("comment/del",{id:e.id}).then((function(t){200==t.code&&(i||0===i?n.commentList[o].children.splice(i,1):n.commentList.splice(o,1))})):t.cancel}})},onCopy:function(){var e=this;t.setClipboardData({data:this.postDetail.content,success:function(){t.hideToast(),e.$q.toast("复制成功","success")}})},saveImgToAlbum:function(){var e=this;t.canvasToTempFilePath({x:0,y:0,width:300,height:450,canvasId:"shareCanvas",success:function(o){t.saveImageToPhotosAlbum({filePath:o.tempFilePath,success:function(){e.showCanvas=!1}})}})},shareCanvas:function(){var e=this;return a(i.default.mark((function o(){var n,s,a,u,c;return i.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return t.showLoading({mask:!0,title:"正在生成海报"}),e.showCanvas=!0,e.showShare=!1,n=t.createCanvasContext("shareCanvas"),n.setFillStyle("#FFFFFF"),n.fillRect(0,0,300,450),s=e.postDetail.media[0]?e.postDetail.media[0]:"https://"+e.$c.baseUrl+"/uploads/default_shre_bg.jpg",o.next=9,e.downloadFile(s);case 9:return a=o.sent,n.drawImage(a,0,0,300,240),n.setFillStyle("#616161"),n.setFontSize(14),e.drawText(n,e.postDetail["content"],20,270,30,260,5),n.setFillStyle("#616161"),n.setFontSize(14),n.fillText("来源：云喵圈子",20,430,300),o.next=19,e.getQrCode();case 19:return u=o.sent,o.next=22,e.downloadFile(u);case 22:c=o.sent,n.drawImage(c,220,370,70,70),n.draw(),t.hideLoading();case 26:case"end":return o.stop()}}),o)})))()},drawText:function(t,e,o,i,n,s,a){for(var u=1,c=0,r=0,l=0;l<e.length;l++)c+=t.measureText(e[l]).width,c>s&&u<=a&&(t.fillText(e.substring(r,l),o,i),i+=22,c=0,r=l,n+=22,u++),l==e.length-1&&u<=a&&t.fillText(e.substring(r,l+1),o,i);return n+=10,n},downloadFile:function(e){return new Promise((function(o){t.downloadFile({url:e,success:function(t){o(t.tempFilePath)}})}))},getQrCode:function(){var t=this;return new Promise((function(e){t.$H.get("post/qrCode",{id:t.postId}).then((function(t){e(t.result)}))}))},onThumbs:function(t,e,o){var i=this;this.$H.post("comment/thumbs",{id:t}).then((function(t){200==t.code&&(o||0==o?(i.commentList[e].children[o].is_thumbs=!0,i.commentList[e].children[o].thumbs++):(i.commentList[e].is_thumbs=!0,i.commentList[e].thumbs++))}))},cancelThumbs:function(t,e,o){var i=this;this.$H.post("comment/cancelThumbs",{id:t}).then((function(t){200==t.code&&(o||0==o?(i.commentList[e].children[o].is_thumbs=!1,i.commentList[e].children[o].thumbs--):(i.commentList[e].is_thumbs=!1,i.commentList[e].thumbs--))}))},onReply:function(t){this.placeholder="回复："+t.userInfo.username,this.focus=!0;var e=t.pid;this.form.pid=0===e?t.id:t.pid,this.form.to_uid=t.userInfo.uid,this.form.post_id=this.postId},onBlur:function(){this.placeholder="说点什么...",this.focus=!1,this.form.pid=0},getCommentList:function(){var t=this;this.loadStatus="loading",this.$H.get("comment/list",{post_id:this.postId,page:this.page}).then((function(e){200==e.code&&(t.commentList=t.commentList.concat(e.result.data),e.result.current_page===e.result.last_page||0===e.result.last_page?t.loadStatus="nomore":t.loadStatus="loadmore")}))},jumpUser:function(e){t.navigateTo({url:"/pages/user/home?uid="+e})},addComment:function(){var e=this;if(this.isSubmitD=!0,""==this.form.content)return this.$u.toast("评论不能为空"),void(this.isSubmitD=!1);t.showLoading({mask:!0,title:"发布中"}),this.$H.post("post/addComment",this.form).then((function(o){console.log(o),200==o.code&&(e.form.content="",e.$u.toast("评论成功"),e.page=1,e.commentList=[],e.getCommentList()),e.isSubmitD=!1,t.hideLoading()}))},getPostDetail:function(){var t=this;this.$H.get("post/detail",{id:this.postId}).then((function(e){if(t.postDetail=e.result,e.result.vote_id>0){e.result.vote_info.options.forEach((function(e){t.$set(e,"checked",!1)}));var o=Date.parse(new Date)/1e3;e.result.vote_info.expire_time<o&&(t.isVoteExpire=!0)}}))},cancelCollection:function(){var t=this;this.$H.post("post/cancelCollection",{id:this.postId}).then((function(e){200===e.code&&(t.postDetail.is_collection=!1,t.postDetail.collection_count--)}))},addCollection:function(){var t=this;this.$H.post("post/addCollection",{id:this.postId,uid:this.postDetail.uid}).then((function(e){200===e.code&&(t.postDetail.is_collection=!0,t.postDetail.collection_count++)}))},addThumb:function(){var t=this;this.$H.post("post/addThumb",{id:this.postId}).then((function(e){200===e.code&&(t.postDetail.is_thumb=!0)}))},cancelThumb:function(){var t=this;this.$H.post("post/cancelThumb",{id:this.postId,uid:this.postDetail.uid}).then((function(e){200===e.code&&(t.postDetail.is_thumb=!1)}))},follow:function(){var t=this;this.$H.post("user/addFollow",{id:this.postDetail.uid}).then((function(e){200===e.code?t.postDetail.is_follow=!0:t.$refs.uToast.show({title:e.msg,type:"error"})}))},cancelFollow:function(){var t=this;this.$H.post("user/cancelFollow",{id:this.postDetail.uid}).then((function(e){200===e.code&&(t.postDetail.is_follow=!1)}))},previewImage:function(e){t.previewImage({current:e.currentTarget.dataset.current,urls:e.currentTarget.dataset.image})}}};e.default=u}).call(this,o("543d")["default"])},6709:function(t,e,o){"use strict";(function(t){o("251e");i(o("66fd"));var e=i(o("b76b"));function i(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=o,t(e.default)}).call(this,o("543d")["createPage"])},b76b:function(t,e,o){"use strict";o.r(e);var i=o("3890"),n=o("1ae0");for(var s in n)"default"!==s&&function(t){o.d(e,t,(function(){return n[t]}))}(s);o("05c9");var a,u=o("f0c5"),c=Object(u["a"])(n["default"],i["b"],i["c"],!1,null,"1818758a",null,!1,i["a"],a);e["default"]=c.exports},e65d:function(t,e,o){}},[["6709","common/runtime","common/vendor"]]]);